function b(){var e,i=0,n=!1;function r(t,o){return e.list.push({type:t,data:o?JSON.parse(JSON.stringify(o)):void 0}),e}return e={list:[],segmentId:function(){return i++},checkIntersection:function(t,o){return r("check",{seg1:t,seg2:o})},segmentChop:function(t,o){return r("div_seg",{seg:t,pt:o}),r("chop",{seg:t,pt:o})},statusRemove:function(t){return r("pop_seg",{seg:t})},segmentUpdate:function(t){return r("seg_update",{seg:t})},segmentNew:function(t,o){return r("new_seg",{seg:t,primary:o})},segmentRemove:function(t){return r("rem_seg",{seg:t})},tempStatus:function(t,o,v){return r("temp_status",{seg:t,above:o,below:v})},rewind:function(t){return r("rewind",{seg:t})},status:function(t,o,v){return r("status",{seg:t,above:o,below:v})},vert:function(t){return t===n?e:(n=t,r("vert",{x:t}))},log:function(t){return typeof t!="string"&&(t=JSON.stringify(t,!1,"  ")),r("log",{txt:t})},reset:function(){return r("reset")},selected:function(t){return r("selected",{segs:t})},chainStart:function(t){return r("chain_start",{seg:t})},chainRemoveHead:function(t,o){return r("chain_rem_head",{index:t,pt:o})},chainRemoveTail:function(t,o){return r("chain_rem_tail",{index:t,pt:o})},chainNew:function(t,o){return r("chain_new",{pt1:t,pt2:o})},chainMatch:function(t){return r("chain_match",{index:t})},chainClose:function(t){return r("chain_close",{index:t})},chainAddHead:function(t,o){return r("chain_add_head",{index:t,pt:o})},chainAddTail:function(t,o){return r("chain_add_tail",{index:t,pt:o})},chainConnect:function(t,o){return r("chain_con",{index1:t,index2:o})},chainReverse:function(t){return r("chain_rev",{index:t})},chainJoin:function(t,o){return r("chain_join",{index1:t,index2:o})},done:function(){return r("done")}},e}var L=b;function ee(e){typeof e!="number"&&(e=1e-10);var i={epsilon:function(n){return typeof n=="number"&&(e=n),e},pointAboveOrOnLine:function(n,r,t){var o=r[0],v=r[1],h=t[0],u=t[1],d=n[0],m=n[1];return(h-o)*(m-v)-(u-v)*(d-o)>=-e},pointBetween:function(n,r,t){var o=n[1]-r[1],v=t[0]-r[0],h=n[0]-r[0],u=t[1]-r[1],d=h*v+o*u;if(d<e)return!1;var m=v*v+u*u;return!(d-m>-e)},pointsSameX:function(n,r){return Math.abs(n[0]-r[0])<e},pointsSameY:function(n,r){return Math.abs(n[1]-r[1])<e},pointsSame:function(n,r){return i.pointsSameX(n,r)&&i.pointsSameY(n,r)},pointsCompare:function(n,r){return i.pointsSameX(n,r)?i.pointsSameY(n,r)?0:n[1]<r[1]?-1:1:n[0]<r[0]?-1:1},pointsCollinear:function(n,r,t){var o=n[0]-r[0],v=n[1]-r[1],h=r[0]-t[0],u=r[1]-t[1];return Math.abs(o*u-h*v)<e},linesIntersect:function(n,r,t,o){var v=r[0]-n[0],h=r[1]-n[1],u=o[0]-t[0],d=o[1]-t[1],m=v*d-h*u;if(Math.abs(m)<e)return!1;var A=n[0]-t[0],y=n[1]-t[1],l=(u*y-d*A)/m,a=(v*y-h*A)/m,f={alongA:0,alongB:0,pt:[n[0]+l*v,n[1]+l*h]};return l<=-e?f.alongA=-2:l<e?f.alongA=-1:l-1<=-e?f.alongA=0:l-1<e?f.alongA=1:f.alongA=2,a<=-e?f.alongB=-2:a<e?f.alongB=-1:a-1<=-e?f.alongB=0:a-1<e?f.alongB=1:f.alongB=2,f},pointInsideRegion:function(n,r){for(var t=n[0],o=n[1],v=r[r.length-1][0],h=r[r.length-1][1],u=!1,d=0;d<r.length;d++){var m=r[d][0],A=r[d][1];A-o>e!=h-o>e&&(v-m)*(o-A)/(h-A)+m-t>e&&(u=!u),v=m,h=A}return u}};return i}var ne=ee,te={create:function(){var e={root:{root:!0,next:null},exists:function(i){return!(i===null||i===e.root)},isEmpty:function(){return e.root.next===null},getHead:function(){return e.root.next},insertBefore:function(i,n){for(var r=e.root,t=e.root.next;t!==null;){if(n(t)){i.prev=t.prev,i.next=t,t.prev.next=i,t.prev=i;return}r=t,t=t.next}r.next=i,i.prev=r,i.next=null},findTransition:function(i){for(var n=e.root,r=e.root.next;r!==null&&!i(r);)n=r,r=r.next;return{before:n===e.root?null:n,after:r,insert:function(t){return t.prev=n,t.next=r,n.next=t,r!==null&&(r.prev=t),t}}}};return e},node:function(e){return e.prev=null,e.next=null,e.remove=function(){e.prev.next=e.next,e.next&&(e.next.prev=e.prev),e.prev=null,e.next=null},e}},re=te,H=re;function ie(e,i,n){function r(a,f){return{id:n?n.segmentId():-1,start:a,end:f,myFill:{above:null,below:null},otherFill:null}}function t(a,f,c){return{id:n?n.segmentId():-1,start:a,end:f,myFill:{above:c.myFill.above,below:c.myFill.below},otherFill:null}}var o=H.create();function v(a,f,c,p,g,C){var E=i.pointsCompare(f,g);return E!==0?E:i.pointsSame(c,C)?0:a!==p?a?1:-1:i.pointAboveOrOnLine(c,p?g:C,p?C:g)?1:-1}function h(a,f){o.insertBefore(a,function(c){var p=v(a.isStart,a.pt,f,c.isStart,c.pt,c.other.pt);return p<0})}function u(a,f){var c=H.node({isStart:!0,pt:a.start,seg:a,primary:f,other:null,status:null});return h(c,a.end),c}function d(a,f,c){var p=H.node({isStart:!1,pt:f.end,seg:f,primary:c,other:a,status:null});a.other=p,h(p,a.pt)}function m(a,f){var c=u(a,f);return d(c,a,f),c}function A(a,f){n&&n.segmentChop(a.seg,f),a.other.remove(),a.seg.end=f,a.other.pt=f,h(a.other,a.pt)}function y(a,f){var c=t(f,a.seg.end,a.seg);return A(a,f),m(c,a.primary)}function l(a,f){var c=H.create();function p(x,S){var k=x.seg.start,D=x.seg.end,B=S.seg.start,I=S.seg.end;return i.pointsCollinear(k,B,I)?i.pointsCollinear(D,B,I)||i.pointAboveOrOnLine(D,B,I)?1:-1:i.pointAboveOrOnLine(k,B,I)?1:-1}function g(x){return c.findTransition(function(S){var k=p(x,S.ev);return k>0})}function C(x,S){var k=x.seg,D=S.seg,B=k.start,I=k.end,X=D.start,U=D.end;n&&n.checkIntersection(k,D);var M=i.linesIntersect(B,I,X,U);if(M===!1){if(!i.pointsCollinear(B,I,X)||i.pointsSame(B,U)||i.pointsSame(I,X))return!1;var j=i.pointsSame(B,X),V=i.pointsSame(I,U);if(j&&V)return S;var q=!j&&i.pointBetween(B,X,U),z=!V&&i.pointBetween(I,X,U);if(j)return z?y(S,I):y(x,U),S;q&&(V||(z?y(S,I):y(x,U)),y(S,B))}else M.alongA===0&&(M.alongB===-1?y(x,X):M.alongB===0?y(x,M.pt):M.alongB===1&&y(x,U)),M.alongB===0&&(M.alongA===-1?y(S,B):M.alongA===0?y(S,M.pt):M.alongA===1&&y(S,I));return!1}for(var E=[];!o.isEmpty();){var s=o.getHead();if(n&&n.vert(s.pt[0]),s.isStart){let x=function(){if(J){var S=C(s,J);if(S)return S}return F?C(s,F):!1};n&&n.segmentNew(s.seg,s.primary);var $=g(s),J=$.before?$.before.ev:null,F=$.after?$.after.ev:null;n&&n.tempStatus(s.seg,J?J.seg:!1,F?F.seg:!1);var R=x();if(R){if(e){var w;s.seg.myFill.below===null?w=!0:w=s.seg.myFill.above!==s.seg.myFill.below,w&&(R.seg.myFill.above=!R.seg.myFill.above)}else R.seg.otherFill=s.seg.myFill;n&&n.segmentUpdate(R.seg),s.other.remove(),s.remove()}if(o.getHead()!==s){n&&n.rewind(s.seg);continue}if(e){var w;s.seg.myFill.below===null?w=!0:w=s.seg.myFill.above!==s.seg.myFill.below,F?s.seg.myFill.below=F.seg.myFill.above:s.seg.myFill.below=a,w?s.seg.myFill.above=!s.seg.myFill.below:s.seg.myFill.above=s.seg.myFill.below}else if(s.seg.otherFill===null){var G;F?s.primary===F.primary?G=F.seg.otherFill.above:G=F.seg.myFill.above:G=s.primary?f:a,s.seg.otherFill={above:G,below:G}}n&&n.status(s.seg,J?J.seg:!1,F?F.seg:!1),s.other.status=$.insert(H.node({ev:s}))}else{var _=s.status;if(_===null)throw new Error("PolyBool: Zero-length segment detected; your epsilon is probably too small or too large");if(c.exists(_.prev)&&c.exists(_.next)&&C(_.prev.ev,_.next.ev),n&&n.statusRemove(_.ev.seg),_.remove(),!s.primary){var P=s.seg.myFill;s.seg.myFill=s.seg.otherFill,s.seg.otherFill=P}E.push(s.seg)}o.getHead().remove()}return n&&n.done(),E}return e?{addRegion:function(a){for(var f,c=a[a.length-1],p=0;p<a.length;p++){f=c,c=a[p];var g=i.pointsCompare(f,c);g!==0&&m(r(g<0?f:c,g<0?c:f),!0)}},calculate:function(a){return l(a,!1)}}:{calculate:function(a,f,c,p){return a.forEach(function(g){m(t(g.start,g.end,g),!0)}),c.forEach(function(g){m(t(g.start,g.end,g),!1)}),l(f,p)}}}var ae=ie;function oe(e,i,n){var r=[],t=[];return e.forEach(function(o){var v=o.start,h=o.end;if(i.pointsSame(v,h)){console.warn("PolyBool: Warning: Zero-length segment detected; your epsilon is probably too small or too large");return}n&&n.chainStart(o);var u={index:0,matches_head:!1,matches_pt1:!1},d={index:0,matches_head:!1,matches_pt1:!1},m=u;function A(_,P,x){return m.index=_,m.matches_head=P,m.matches_pt1=x,m===u?(m=d,!1):(m=null,!0)}for(var y=0;y<r.length;y++){var l=r[y],a=l[0];l[1];var f=l[l.length-1];if(l[l.length-2],i.pointsSame(a,v)){if(A(y,!0,!0))break}else if(i.pointsSame(a,h)){if(A(y,!0,!1))break}else if(i.pointsSame(f,v)){if(A(y,!1,!0))break}else if(i.pointsSame(f,h)&&A(y,!1,!1))break}if(m===u){r.push([v,h]),n&&n.chainNew(v,h);return}if(m===d){n&&n.chainMatch(u.index);var c=u.index,p=u.matches_pt1?h:v,g=u.matches_head,l=r[c],C=g?l[0]:l[l.length-1],E=g?l[1]:l[l.length-2],s=g?l[l.length-1]:l[0],$=g?l[l.length-2]:l[1];if(i.pointsCollinear(E,C,p)&&(g?(n&&n.chainRemoveHead(u.index,p),l.shift()):(n&&n.chainRemoveTail(u.index,p),l.pop()),C=E),i.pointsSame(s,p)){r.splice(c,1),i.pointsCollinear($,s,C)&&(g?(n&&n.chainRemoveTail(u.index,C),l.pop()):(n&&n.chainRemoveHead(u.index,C),l.shift())),n&&n.chainClose(u.index),t.push(l);return}g?(n&&n.chainAddHead(u.index,p),l.unshift(p)):(n&&n.chainAddTail(u.index,p),l.push(p));return}function J(_){n&&n.chainReverse(_),r[_].reverse()}function F(_,P){var x=r[_],S=r[P],k=x[x.length-1],D=x[x.length-2],B=S[0],I=S[1];i.pointsCollinear(D,k,B)&&(n&&n.chainRemoveTail(_,k),x.pop(),k=D),i.pointsCollinear(k,B,I)&&(n&&n.chainRemoveHead(P,B),S.shift()),n&&n.chainJoin(_,P),r[_]=x.concat(S),r.splice(P,1)}var R=u.index,w=d.index;n&&n.chainConnect(R,w);var G=r[R].length<r[w].length;u.matches_head?d.matches_head?G?(J(R),F(R,w)):(J(w),F(w,R)):F(w,R):d.matches_head?F(R,w):G?(J(R),F(w,R)):(J(w),F(R,w))}),t}var le=oe;function T(e,i,n){var r=[];return e.forEach(function(t){var o=(t.myFill.above?8:0)+(t.myFill.below?4:0)+(t.otherFill&&t.otherFill.above?2:0)+(t.otherFill&&t.otherFill.below?1:0);i[o]!==0&&r.push({id:n?n.segmentId():-1,start:t.start,end:t.end,myFill:{above:i[o]===1,below:i[o]===2},otherFill:null})}),n&&n.selected(r),r}var fe={union:function(e,i){return T(e,[0,2,1,0,2,2,0,0,1,0,1,0,0,0,0,0],i)},intersect:function(e,i){return T(e,[0,0,0,0,0,2,0,2,0,0,1,1,0,2,1,0],i)},difference:function(e,i){return T(e,[0,0,0,0,2,0,2,0,1,1,0,0,0,1,2,0],i)},differenceRev:function(e,i){return T(e,[0,2,1,0,0,0,1,1,0,2,0,2,0,0,0,0],i)},xor:function(e,i){return T(e,[0,2,1,0,2,0,0,1,1,0,0,2,0,1,2,0],i)}},se=fe,ce={toPolygon:function(e,i){function n(o){if(o.length<=0)return e.segments({inverted:!1,regions:[]});function v(d){var m=d.slice(0,d.length-1);return e.segments({inverted:!1,regions:[m]})}for(var h=v(o[0]),u=1;u<o.length;u++)h=e.selectDifference(e.combine(h,v(o[u])));return h}if(i.type==="Polygon")return e.polygon(n(i.coordinates));if(i.type==="MultiPolygon"){for(var r=e.segments({inverted:!1,regions:[]}),t=0;t<i.coordinates.length;t++)r=e.selectUnion(e.combine(r,n(i.coordinates[t])));return e.polygon(r)}throw new Error("PolyBool: Cannot convert GeoJSON object to PolyBool polygon")},fromPolygon:function(e,i,n){n=e.polygon(e.segments(n));function r(l,a){return i.pointInsideRegion([(l[0][0]+l[1][0])*.5,(l[0][1]+l[1][1])*.5],a)}function t(l){return{region:l,children:[]}}var o=t(null);function v(l,a){for(var f=0;f<l.children.length;f++){var c=l.children[f];if(r(a,c.region)){v(c,a);return}}for(var p=t(a),f=0;f<l.children.length;f++){var c=l.children[f];r(c.region,a)&&(p.children.push(c),l.children.splice(f,1),f--)}l.children.push(p)}for(var h=0;h<n.regions.length;h++){var u=n.regions[h];u.length<3||v(o,u)}function d(l,a){for(var f=0,c=l[l.length-1][0],p=l[l.length-1][1],g=[],C=0;C<l.length;C++){var E=l[C][0],s=l[C][1];g.push([E,s]),f+=s*c-E*p,c=E,p=s}var $=f<0;return $!==a&&g.reverse(),g.push([g[0][0],g[0][1]]),g}var m=[];function A(l){var a=[d(l.region,!1)];m.push(a);for(var f=0;f<l.children.length;f++)a.push(y(l.children[f]))}function y(l){for(var a=0;a<l.children.length;a++)A(l.children[a]);return d(l.region,!0)}for(var h=0;h<o.children.length;h++)A(o.children[h]);return m.length<=0?{type:"Polygon",coordinates:[]}:m.length==1?{type:"Polygon",coordinates:m[0]}:{type:"MultiPolygon",coordinates:m}}},ue=ce;/*
 * @copyright 2016 Sean Connelly (@voidqk), http://syntheti.cc
 * @license MIT
 * @preserve Project Home: https://github.com/voidqk/polybooljs
 */var ve=L,he=ne,K=ae,me=le,Y=se,Q=ue,N=!1,W=he(),O;O={buildLog:function(e){return e===!0?N=ve():e===!1&&(N=!1),N===!1?!1:N.list},epsilon:function(e){return W.epsilon(e)},segments:function(e){var i=K(!0,W,N);return e.regions.forEach(i.addRegion),{segments:i.calculate(e.inverted),inverted:e.inverted}},combine:function(e,i){var n=K(!1,W,N);return{combined:n.calculate(e.segments,e.inverted,i.segments,i.inverted),inverted1:e.inverted,inverted2:i.inverted}},selectUnion:function(e){return{segments:Y.union(e.combined,N),inverted:e.inverted1||e.inverted2}},selectIntersect:function(e){return{segments:Y.intersect(e.combined,N),inverted:e.inverted1&&e.inverted2}},selectDifference:function(e){return{segments:Y.difference(e.combined,N),inverted:e.inverted1&&!e.inverted2}},selectDifferenceRev:function(e){return{segments:Y.differenceRev(e.combined,N),inverted:!e.inverted1&&e.inverted2}},selectXor:function(e){return{segments:Y.xor(e.combined,N),inverted:e.inverted1!==e.inverted2}},polygon:function(e){return{regions:me(e.segments,W,N),inverted:e.inverted}},polygonFromGeoJSON:function(e){return Q.toPolygon(O,e)},polygonToGeoJSON:function(e){return Q.fromPolygon(O,W,e)},union:function(e,i){return Z(e,i,O.selectUnion)},intersect:function(e,i){return Z(e,i,O.selectIntersect)},difference:function(e,i){return Z(e,i,O.selectDifference)},differenceRev:function(e,i){return Z(e,i,O.selectDifferenceRev)},xor:function(e,i){return Z(e,i,O.selectXor)}};function Z(e,i,n){var r=O.segments(e),t=O.segments(i),o=O.combine(r,t),v=n(o);return O.polygon(v)}typeof window=="object"&&(window.PolyBool=O);var ge=O;export{ge as p};
