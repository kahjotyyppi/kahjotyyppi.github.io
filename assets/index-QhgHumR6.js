import{c as Ce}from"./vue-i18n-BGqbPcXW.js";import"./vue-UO-WCss_.js";import{e as l,f as u,B as p,E as g,C as z,A as C,b6 as r,F as R,i as B,v as _,K as $,L as y,I as O,g as c,b3 as Y,b0 as K,x as D,k as Le,j as E,r as Te,b7 as Me,M as Fe,ai as Pe}from"./@vue-DDeinw2Q.js";import{o as se,f as ne,G as ie,a as oe,C as re,F as le,p as de,P as ce,t as ue,O as me,e as Re,q as Be,b as Ie,Z as Ve,r as Oe,s as Ee,A as Ae,j as xe,m as Ne}from"./ol-DzNpB_tl.js";import{a as je}from"./axios-DItqprHK.js";import{e as I}from"./tiny-emitter-CXMEUKym.js";import{c as Ue}from"./vuex-BxxqU3Y-.js";import{P as pe,l as qe}from"./plotly.js-KBlAECHj.js";import{H as he}from"./@vuepic-CGHycopB.js";import"./ol-mapbox-style-ua2uOGgb.js";import{c as V}from"./lodash-DSVXnfiF.js";import{p as fe}from"./vue3-click-away-cDExn2lm.js";import{V as Ge}from"./@aacassandra-pz1HVmjO.js";import"./@intlify-BqCMBkRY.js";import"./rbush-DoHIURGA.js";import"./quickselect-cI_fw6Fh.js";import"./pbf-BTfkS4aW.js";import"./ieee754-DSYfm7We.js";import"./color-space-CC1atxIw.js";import"./color-rgba-BJ4KHDKn.js";import"./color-parse-DZuJRDq4.js";import"./@plotly-CLRy4VIE.js";import"./is-mobile-DTbNOGI7.js";import"./native-promise-only-CYKzaYRM.js";import"./d3-time-format-V4SPq9Mp.js";import"./d3-time-B-_V6VeC.js";import"./d3-format-BFcfDj9j.js";import"./fast-isnumeric-a5YRvFrk.js";import"./is-string-blank-CjnoGYLr.js";import"./base64-arraybuffer-D8bludU8.js";import"./tinycolor2-84Wnvw89.js";import"./gl-mat4-DY9MfRJ-.js";import"./has-hover-CznNzQ9h.js";import"./is-browser-36xSGOqd.js";import"./events-CXH2uRM3.js";import"./parse-svg-path-C3wHdri1.js";import"./mouse-event-offset--XKrXIUx.js";import"./has-passive-events-w9EHtJMP.js";import"./polybooljs-C8JaxsT5.js";import"./point-in-polygon-C7qZ-OSy.js";import"./date-fns-C7_rVUPb.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function a(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(n){if(n.ep)return;n.ep=!0;const s=a(n);fetch(n.href,s)}})();var He={VITE_MML_API_KEY:"ba40e643-3a55-487f-aea4-c5906b1b597f",BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1,APP_VERSION:"3.0.0",NODE_ENV:"production"},G=Ce({inheriteLocale:!0,globalInjection:!0,legacy:!1,locale:localStorage.getItem("locale"),fallbackLocale:He.VUE_APP_I18N_FALLBACK_LOCALE||"fi",preserveDirectiveContent:!1,messages:{fi:{info:{header:"Tietoa",title:"Tietoa",p1:"Opendata on STUKin kehittämä avoimen lähdekoodin applikaatio, jolla voit tarkastella Suomen ulkoisen säteilyn valvontaverkon mittaustuloksia. Applikaatio saa datansa Ilmatieteen laitoksen avoimen datan rajapinnasta.",p2:"Lue lisää projektin ",p3:"GitHub-sivuilta"},settings:{title:"Asetukset",header:"Asetukset",language:"Kieli",date:"Päivitä päivämäärää",time:"Päivitä kellonaikaa",dateFormat:"Päiväyksen muoto",dateFormatA:"PP.KK.VVVV",dateFormatB:"VVVV-KK-PP",labelFinnish:"Suomi",labelEnglish:"Englanti",timeFormat:"Ajan esitysmuoto",timeFormatA:"24 tunnin kello",timeFormatB:"12 tunnin kello",backgroundMap:"Kartta",backgroundMapDefault:"Oletus (OSM)",backgroundMapCustom:"Mukautettu"},changeMode:{title:"Vaihda näkymää (annosnopeudet/ilman radioaktiivisuus)"},playback:{title:{date:"Päivitä päiväämäärää",time:"Päivitä kellonaikaa",disabled:{date:"Valitse aikaisempi päivämäärä",time:"Valitse aikaisempi kellonaika"},start:"Aloita toisto",stop:"Pysäytä toisto",speed:"Toistonopeus"}},dose:{doseRateTresholds:"Annosnopeusrajat"},radionuclideMode:{date:"Keräysjakso",concentration:"Aktiivisuuspitoisuus",uncertainty:"Epävarmuus",noData:"Tälle aikajaksolle ei ole saatavilla dataa",info:"Pääkaupunkiseudun mittauspiste on muuttanut vuoden 2022 toukokuun alusta Helsingistä Vantaalle. Vuoden 2022 huhtikuun loppuun saakka mittaustuloksia voi hakea Helsingistä. Toukokuusta 2022 alkaen tulokset löytyvät Vantaalta."},doseRate:"Annosnopeudet",airRadionuclides:"Ilman Radionuklidit"},en:{info:{header:"About",title:"About",p1:"Opendata is an open source application developed by STUK that enables viewing of external radiation results from around Finland. The application gets its data from the Finnish Meteorological Institute's open data API.",p2:"To learn more visit the project on ",p3:"GitHub"},settings:{title:"Settings",header:"Settings",language:"Language",date:"Update date",time:"Update time",dateFormat:"Date format",dateFormatA:"DD.MM.YYYY",dateFormatB:"YYYY.MM.DD",labelFinnish:"Finnish",labelEnglish:"English",timeFormat:"Time notation",timeFormatA:"24-hour clock",timeFormatB:"12-hour clock",backgroundMap:"Map",backgroundMapDefault:"Default (OSM)",backgroundMapCustom:"Custom"},changeMode:{title:"Change mode (dose rates/air radionuclides)"},playback:{title:{date:"Update date",time:"Update time",disabled:{date:"Choose an earlier date to enable playback",time:"Choose an earlier time to enable playback"},start:"Start playback",stop:"Stop playback",speed:"Playback speed"}},dose:{doseRateTresholds:"Dose rate thresholds"},radionuclideMode:{date:"Collection Period",concentration:"Concentration",uncertainty:"Uncertainty",noData:"No data available for this time period",info:"The measurement point for the capital region has moved from Helsinki to Vantaa at the beginning of May 2022. Until the end of April 2022, you can view measurement results from Helsinki. From may 2022, the results can be found from Vantaa."},doseRate:"Dose Rates",airRadionuclides:"Air Radionuclides"}}});const m=(e,t)=>{const a=e.__vccOpts||e;for(const[i,n]of t)a[i]=n;return a},ze={name:"BaseRadioButton",props:{label:{type:String,required:!0},ownValue:{type:String,required:!0},modelValue:{type:String,required:!0}},emits:["update:modelValue"],data(){return{id:String(Math.random())}},computed:{isChecked(){return this.ownValue===this.modelValue}},methods:{onChange(){this.$emit("update:modelValue",this.ownValue)}}},Ye=["id","checked"],Ke=["for"];function Ze(e,t,a,i,n,s){return l(),u("div",{key:a.label,class:"container"},[p("input",{id:n.id,type:"radio",class:"radio-button-input",checked:s.isChecked,onChange:t[0]||(t[0]=(...o)=>s.onChange&&s.onChange(...o))},null,40,Ye),p("label",{class:"label",for:n.id},g(a.label),9,Ke)])}const Je=m(ze,[["render",Ze],["__scopeId","data-v-21683c87"]]),We={install(e){e.component("BaseRadioButton",Je)}},w={async get(e){return await je.get(e)}},Qe={async queryAvailableDatasets(){let t=(await w.get("data/dose_rates/metadata.json")).data.available_data;return t.forEach(a=>{a.date=new Date(a.date),a.times.sort()}),t.sort((a,i)=>new Date(a.date)-new Date(i.date)),t},async getDataset(e){return(await w.get(e)).data},async getTimeSeries(e,t){const a=t.toISOString().split("T")[0],i="data/dose_rates/time_series/"+e+"/"+a+".json";return(await w.get(i)).data.data}},H={async getDataset(e){return(await w.get(e)).data},async getTimeSeries(e,t,a){const i=[],n=new Date(a),s=24*60*60*1e3,o=new Date(n.getTime()-30*s),d=`data/air_radionuclides/time_series/${e}/${t}/available_filenames.json`;try{const b=(await w.get(d)).data;for(const v of b){const k=v.replace(".json","").split("TO");if(k.length===2){const S=new Date(k[0]),F=new Date(k[1]);if(S<=n&&S>=o||F<=n&&F>=o||S<=o&&F>=n){const U=`data/air_radionuclides/time_series/${e}/${t}/${v}`;try{const P=await w.get(U);P.data&&P.data.data&&i.push(...P.data.data)}catch{console.log(`Data not found for file ${v}`)}}}}}catch(h){console.error(`Error fetching available files: ${h}`)}return i},async getAvailableRadionuclides(e){const t=`/data/air_radionuclides/time_series/${e}/available_radionuclides.json`;try{const a=await w.get(t);return a&&a.data&&Array.isArray(a.data)?a.data:(console.error("Invalid response format for available radionuclides:",a),[])}catch(a){return console.error(`Error fetching available radionuclides for site ${e}:`,a),[]}}},A={doseRate:Qe,airRadionuclide:H},f={$on:(...e)=>I.on(...e),$once:(...e)=>I.once(...e),$off:(...e)=>I.off(...e),$emit:(...e)=>I.emit(...e)},Xe={name:"DoseRateLayer",emits:["doseRateLayerChanged"],data(){return{vectorLayer:new se({source:new ne({format:new ie({defaultDataProjection:"EPSG:4326"})}),renderMode:"vector",preload:20,renderBuffer:20,renderOrder:function(e,t){return e.get("doseRate")<t.get("doseRate")?-1:1},style:e=>{let t="#0000";const a=e.get("doseRate"),i=this.$store.state.settings.settings.mapLegend.bars;for(let s=0;s<i.length;++s){const o=i[s].threshold,d=i[s+1]?i[s+1].threshold:1e9;if(a>=o&&a<d)if(i[s].isEnabled){t=i[s].color;break}else return}return[new oe({image:new re({radius:this.featureRadius,fill:new le({color:t})})})]}})}},computed:{mode(){return this.$store.state.settings.settings.mode},isDoseRateMode(){return this.mode==="dose_rates"},datasetFilePath(){return!this.isDoseRateMode||!this.$store.state.datetime.selectedDate?"":"data/dose_rates/datasets/"+this.$store.state.datetime.selectedDate.toISOString().split("T")[0]+"T"+this.$store.state.datetime.selectedTime+".json"},doseRateRanges(){return this.$store.state.settings.settings.mapLegend.bars}},watch:{datasetFilePath:async function(){if(!this.isDoseRateMode)return"";try{this.$Progress.start();const t=(await A.doseRate.getDataset(this.datasetFilePath)).features.map(a=>new de({geometry:new ce(ue(a.geometry.coordinates,"EPSG:4326","EPSG:3857")),id:a.properties.id,site:a.properties.site,doseRate:a.properties.doseRate}));this.vectorLayer.getSource().clear(!0),this.vectorLayer.getSource().addFeatures(t),f.$emit("doseRateLayerChanged",this.vectorLayer),this.$Progress.finish()}catch{this.$Progress.fail()}},doseRateRanges:{handler:function(){this.isDoseRateMode&&this.redraw()},deep:!0}},mounted(){this.isDoseRateMode&&f.$on("settingsChanged",this.redraw)},methods:{redraw(){this.isDoseRateMode&&this.vectorLayer.changed()},updateFeatureRadius(e){if(this.isDoseRateMode){const t=this.featureRadius,a=e*2;a!==t&&(this.featureRadius=a,this.redraw())}}}};function et(e,t,a,i,n,s){return l(),u("div")}const tt=m(Xe,[["render",et],["__scopeId","data-v-980e98ae"]]),at={name:"RadionuclideLayer",emits:["radionuclideLayerChanged"],data(){return{vectorLayer:new se({source:new ne({format:new ie({defaultDataProjection:"EPSG:4326"})}),renderMode:"vector",preload:20,renderBuffer:20,style:()=>{const e="#1d66af";return[new oe({image:new re({radius:this.featureRadius,fill:new le({color:e})})})]}})}},computed:{mode(){return this.$store.state.settings.settings.mode},isAirRadionuclidesMode(){return this.mode==="air_radionuclides"},datasetFilePath(){return this.isAirRadionuclidesMode?"data/air_radionuclides/time_series/sites.json":""}},watch:{datasetFilePath:async function(){if(this.isAirRadionuclidesMode)try{this.$Progress.start();const t=(await A.airRadionuclide.getDataset(this.datasetFilePath)).map(a=>new de({geometry:new ce(ue(a.coordinates,"EPSG:4326","EPSG:3857")),id:a.id,site:a.site}));this.vectorLayer.getSource().clear(!0),this.vectorLayer.getSource().addFeatures(t),f.$emit("radionuclideLayerChanged",this.vectorLayer),this.$Progress.finish()}catch{this.$Progress.fail()}}},mounted(){this.isAirRadionuclidesMode&&f.$on("settingsChanged",this.redraw)},methods:{redraw(){this.isAirRadionuclidesMode&&this.vectorLayer.changed()},updateFeatureRadius(e){if(this.isAirRadionuclidesMode){const t=this.featureRadius,a=e*2;a!==t&&(this.featureRadius=a,this.redraw())}}}};function st(e,t,a,i,n,s){return l(),u("div")}const nt=m(at,[["render",st],["__scopeId","data-v-fd547418"]]),it={name:"MapLegendBar",props:{mapLegendBar:{type:Object,required:!0}},emits:["click"]};function ot(e,t,a,i,n,s){return l(),u("div",{style:z({backgroundColor:a.mapLegendBar.color}),class:C([{"map-legend__bar--disabled":!a.mapLegendBar.isEnabled},"map-legend__bar"]),onClick:t[0]||(t[0]=o=>e.$emit("click"))},g(a.mapLegendBar.label),7)}const rt=m(it,[["render",ot]]),lt={name:"MapLegend",components:{MapLegendBar:rt},computed:{mapLegendBars(){return this.$store.state.settings.settings.mapLegend.bars}},methods:{toggle(e){this.$store.state.settings.settings.mapLegend.toggleBar(e)}}},dt={class:"map-legend"};function ct(e,t,a,i,n,s){const o=r("map-legend-bar");return l(),u("div",dt,[(l(!0),u(R,null,B(s.mapLegendBars,(d,h)=>(l(),_(o,{key:h,"map-legend-bar":d,onClick:b=>s.toggle(h)},null,8,["map-legend-bar","onClick"]))),128))])}const ut=m(lt,[["render",ct]]),mt={name:"SiteName",props:{feature:{type:Object,default:void 0},disableCloseButton:{type:Boolean,default:!1}},emits:["close"],computed:{site(){return this.feature?this.feature.get("site"):"-"}}},pt={class:"site-header opendata-row"},ht={class:"site-name"};function ft(e,t,a,i,n,s){return l(),u("div",pt,[p("span",ht,g(s.site),1),$(p("span",{class:"close-button",onClick:t[0]||(t[0]=o=>e.$emit("close"))},"×",512),[[y,!a.disableCloseButton]])])}const ge=m(mt,[["render",ft],["__scopeId","data-v-498617e8"]]),gt={name:"SiteDoseRate",props:{feature:{type:Object,default:void 0}},computed:{doseRate(){return this.feature&&this.feature.get("doseRate")!==null?this.feature.get("doseRate"):"-"}}},_t={class:"site-dose-rate"},bt={class:"site-dose-rate__value"},$t=p("span",{class:"site-dose-rate__unit"}," µSv/h",-1);function yt(e,t,a,i,n,s){return l(),u("div",_t,[p("span",bt,[O(g(s.doseRate),1),$t])])}const _e=m(gt,[["render",yt]]),vt={name:"FeaturePopover",components:{SiteName:ge,SiteDoseRate:_e},data(){return{isEnabled:!0,overlay:void 0,feature:void 0,previousFeature:void 0}},computed:{mode(){return this.$store.state.settings.settings.mode},isDoseRatesMode(){return this.mode==="dose_rates"},isRadionuclideMode(){return this.mode==="air_radionuclides"}},mounted(){f.$on("featureHovered",this.open),f.$on("emptyMapLocationHovered",this.close),f.$on("featurePopupOpened",this.disable),f.$on("featurePopupClosed",this.enable),f.$on("doseRateLayerChanged",this.update),f.$on("radioNuclideLayerChanged",this.update),this.overlay=new me({element:this.$refs.featurePopover,position:void 0})},methods:{enable(){this.isEnabled=!0},disable(){this.isEnabled=!1,this.close()},open(e){this.isEnabled&&e!==this.previousFeature&&(this.feature=e,this.overlay.setPosition(e.getGeometry().getCoordinates()),this.previousFeature=e)},close(){this.overlay.setPosition(void 0),this.previousFeature=void 0},update(e){var t=e.getSource().getFeatures();if(t.length!=0){for(var a=0;a<t.length;++a)if(t[a].get("id")==this.siteId){this.feature=t[a];return}this.feature=void 0}}}},Dt={ref:"featurePopover",class:"feature-popover"};function kt(e,t,a,i,n,s){const o=r("site-name"),d=r("site-dose-rate");return l(),u("div",Dt,[c(o,{feature:n.feature,"disable-close-button":""},null,8,["feature"]),$(c(d,{feature:n.feature},null,8,["feature"]),[[y,s.isDoseRatesMode]])],512)}const St=m(vt,[["render",kt]]),Z={getDatesBetween(e,t){for(var a=[],i=new Date(e),n=new Date(t);i<=n;)a.push(new Date(i)),i.setDate(i.getDate()+1);return a},convertTimeTo12HourClock(e){var t=+e.substr(0,2),a=t%12||12,i=t<12?"am":"pm";return a+e.substr(2,3)+" "+i}};function wt(e){return new Promise(t=>setTimeout(t,e))}const Ct={setTime(e,t){e.selectedTime=t},setDate(e,t){e.selectedDate=t},setAvailableDatasets(e,t){e.availableDatasets=t}},Lt={async initialize({dispatch:e}){await e("queryAvailableDatasets"),await e("selectNewestDate"),await e("selectNewestTime"),setInterval(()=>{e("queryAvailableDatasets")},6e5)},async queryAvailableDatasets({commit:e}){const t=await A.doseRate.queryAvailableDatasets();e("setAvailableDatasets",t)},selectNewestDate({state:e,dispatch:t}){if(e.availableDatasets.length==0)return;const a=e.availableDatasets.slice(-1)[0].date;t("setDate",a)},selectNewestTime({getters:e,commit:t}){const a=e.availableTimesForSelectedDate;if(a.length!=0){var i=a.slice(-1)[0];t("setTime",i)}},decrementTime({commit:e,dispatch:t,getters:a,state:i}){if(a.isOldestDateSelected&&a.isOldestTimeSelected)return;const n=a.availableTimesForSelectedDate.indexOf(i.selectedTime);if(n==0)t("decrementDate"),t("selectNewestTime");else{const o=a.availableTimesForSelectedDate[n-1];e("setTime",o)}},incrementTime({commit:e,dispatch:t,getters:a,state:i}){if(a.isNewestDateSelected&&a.isNewestTimeSelected)return;const n=a.availableTimesForSelectedDate.indexOf(i.selectedTime);if(n==a.availableTimesForSelectedDate.length-1)t("incrementDate"),e("setTime",a.availableTimesForSelectedDate[0]);else{const o=a.availableTimesForSelectedDate[n+1];e("setTime",o)}},decrementDate({dispatch:e,getters:t,state:a}){if(!t.isOldestDateSelected){const n=a.availableDatasets.map(o=>o.date.toDateString()).indexOf(a.selectedDate.toDateString()),s=a.availableDatasets[n-1].date;e("setDate",s)}},incrementDate({dispatch:e,getters:t,state:a}){if(!t.isNewestDateSelected){const n=a.availableDatasets.map(o=>o.date.toDateString()).indexOf(a.selectedDate.toDateString()),s=a.availableDatasets[n+1].date;e("setDate",s)}},setDate({state:e,commit:t,dispatch:a,getters:i},n){t("setDate",n),i.availableTimesForSelectedDate.includes(e.selectedTime)||a("selectNewestTime")}},Tt={availableTimesForSelectedDate(e){if(!e.selectedDate)return[];for(let t=0;t<e.availableDatasets.length;++t)if(e.availableDatasets[t].date.toDateString()==e.selectedDate.toDateString())return e.availableDatasets[t].times;return[]},isOldestDateSelected(e){if(e.availableDatasets.length==0||!e.selectedDate)return!1;const t=e.availableDatasets[0].date;return e.selectedDate.toDateString()==t.toDateString()},isNewestDateSelected(e){if(e.availableDatasets.length==0||!e.selectedDate)return!1;const t=e.availableDatasets.slice(-1)[0].date;return e.selectedDate.toDateString()==t.toDateString()},isOldestTimeSelected(e,t){if(t.isOldestDateSelected){const a=t.availableTimesForSelectedDate[0];return e.selectedTime==a}return!1},isNewestTimeSelected(e,t){if(t.isNewestDateSelected){const a=t.availableTimesForSelectedDate.slice(-1)[0];return e.selectedTime==a}return!1}},Mt={state:{availableDatasets:[],selectedDate:void 0,selectedTime:void 0},mutations:Ct,actions:Lt,getters:Tt},Ft={setSettings(e,t){e.settings=t,e.settings.save()}},Pt={initialize({state:e}){e.settings.load()}};class Rt{constructor(){this.bars=[],this.addBar(new L(0,"#1dafaf")),this.addBar(new L(.1,"#1d8baf")),this.addBar(new L(.2,"#1d66af")),this.addBar(new L(.3,"#1d41af")),this.addBar(new L(.4,"#411daf"))}addBar(t){let a=this.bars.slice(-1)[0];a&&(a.nextBar=t),this.bars.push(t)}toggleBar(t){const a=this.bars[t];a.toggleState(),this.bars[t]=a}clear(){this.bars=[]}toString(){return JSON.stringify(this.bars.map(t=>t.toString()))}}class L{constructor(t,a){this.nextBar=void 0,this.threshold=t<10?t.toFixed(1):t,this.color=a,this.isEnabled=!0}get label(){return this.nextBar?`${this.threshold} - ${this.nextBar.threshold}`:`> ${this.threshold} µSv/h`}toggleState(){this.isEnabled=!this.isEnabled}toString(){return`{"threshold": ${this.threshold}, "color": "${this.color}"}`}}const W="locale",Q="dateFormat",X="timeFormat",q="mapLegend",ee="backgroundMap",te="mode";class be{constructor(){this.locale="en",this.dateFormat="fi",this.timeFormat="24h",this.mapLegend=new Rt,this.backgroundMap="default",this.mode="dose_rates"}save(){G.global.locale.value=this.locale,localStorage.setItem(W,this.locale),localStorage.setItem(Q,this.dateFormat),localStorage.setItem(X,this.timeFormat),localStorage.setItem(q,this.mapLegend),localStorage.setItem(ee,this.backgroundMap),localStorage.setItem(te,this.mode)}load(){this.locale=localStorage.getItem(W)||this.locale,G.global.locale.value=this.locale,this.dateFormat=localStorage.getItem(Q)||this.dateFormat,this.timeFormat=localStorage.getItem(X)||this.timeFormat,this.backgroundMap=localStorage.getItem(ee)||this.backgroundMap,this.mode=localStorage.getItem(te)||this.mode;let t=localStorage.getItem(q);if(t)try{t=JSON.parse(t);const a=t.map(i=>JSON.parse(i));a.length>0&&(this.mapLegend.clear(),a.forEach(i=>{this.mapLegend.addBar(new L(i.threshold,i.color))}))}catch{localStorage.removeItem(q)}}}const Bt={state:{settings:new be},mutations:Ft,actions:Pt},T=Ue({modules:{datetime:Mt,settings:Bt}});class It{constructor(t,a){this.date=t,this.dataPoints=a}}let ae=class{constructor(t){this.siteId=t,this.dataPoints=[],this.datasets=[],this.startDate=void 0,this.endDate=void 0,this.onUpdate=()=>{},this.isLoading=!1}loadTimespan(t,a){this.startDate=t,this.endDate=a,this.startDate&&this.endDate&&this.siteId&&this.update()}async update(){let t=Z.getDatesBetween(this.startDate,this.endDate);t=t.filter(a=>{const i=this.datasets.some(s=>s.date.getTime()==a.getTime()),n=T.state.datetime.availableDatasets.some(s=>s.date.getTime()==a.getTime());return!i&&n}),t.length>0&&(this.isLoading=!0,await Promise.allSettled(t.map(async a=>{let i;try{i=await A.doseRate.getTimeSeries(this.siteId,a)}finally{this.datasets.push(new It(a,i))}})),await wt(250),this.datasets.sort((a,i)=>a.date<i.date?-1:1),this.generateDataPoints(),this.isLoading=!1),this.onUpdate()}generateDataPoints(){let t=[],a=[];for(var i=0;i<this.datasets.length;++i)if(this.datasets[i].dataPoints)for(var n=0;n<this.datasets[i].dataPoints.length;++n){const s=this.datasets[i].dataPoints[n];t.push(new Date(s.e).toISOString()),a.push(s.r)}this.dataPoints=[{x:t,y:a}]}};const Vt={name:"LoadingSpinner",props:{isEnabled:{type:Boolean,default:!1}}},Ot=e=>(Y("data-v-3f037726"),e=e(),K(),e),Et={class:"spinner-container"},At=Ot(()=>p("div",{class:"spinner"},null,-1)),xt=[At];function Nt(e,t,a,i,n,s){return $((l(),u("div",Et,xt,512)),[[y,a.isEnabled]])}const $e=m(Vt,[["render",Nt],["__scopeId","data-v-3f037726"]]);pe.register(qe);const jt={name:"TimeSeriesGraph",components:{LoadingSpinner:$e},props:{feature:{type:Object,default:void 0}},data:function(){return{timeSeriesGraph:new ae,plotlyLayout:{},defaultPlotlyLayout:{width:0,height:0,dragmode:"pan",margin:{t:20,r:0,b:50,l:50,pad:15},yaxis:{range:[0,.4]},font:{size:12,family:"RedHatText-Medium"}},plotlyConfig:{scrollZoom:!0,connectGaps:!0,displayModeBar:!1,locale:"en"}}},computed:{selectedDate(){return this.$store.state.datetime.selectedDate},locale(){return this.$store.state.settings.settings.locale},isLoading(){return this.timeSeriesGraph.isLoading},featureId(){return this.feature?this.feature.get("id"):void 0},mode(){return this.$store.state.settings.settings.mode},isAirRadionuclidesMode(){return this.mode==="air_radionuclides"}},watch:{featureId:function(){this.reset()},selectedDate:function(){this.reset()},locale:function(e){this.plotlyConfig.locale=e,this.draw()}},mounted(){this.updateSize(!0),this.$refs.graphContainer.on("plotly_relayout",this.onPlotlyRelayout),window.onresize=this.updateSize},methods:{draw(){this.isAirRadionuclidesMode||(this.updateSize(),pe.react(this.$refs.graphContainer,this.timeSeriesGraph.dataPoints,this.plotlyLayout,this.plotlyConfig))},async onPlotlyRelayout(e){if(!this.isAirRadionuclidesMode){if(!e||!e["xaxis.range[0]"]||!e["xaxis.range[1]"])return;const t=new Date(e["xaxis.range[0]"].split(" ")[0]),a=new Date(e["xaxis.range[1]"].split(" ")[0]);await this.timeSeriesGraph.loadTimespan(t,a)}},updateSize(e=!1){this.isAirRadionuclidesMode||(window.innerWidth>=1024?(this.plotlyLayout.width=475,this.plotlyLayout.height=400,this.plotlyLayout.font={size:14}):window.innerWidth>=768?(this.plotlyLayout.width=300,this.plotlyLayout.height=220,this.plotlyLayout.font={size:12}):(this.plotlyLayout.width=300,this.plotlyLayout.height=180,this.plotlyLayout.font={size:10}),e&&this.draw())},reset(){this.isAirRadionuclidesMode||(this.plotlyLayout=JSON.parse(JSON.stringify(this.defaultPlotlyLayout)),this.timeSeriesGraph=new ae(this.featureId),this.timeSeriesGraph.onUpdate=this.draw.bind(this),this.timeSeriesGraph.loadTimespan(this.selectedDate,this.selectedDate))}}},Ut={class:"wrapper"},qt={ref:"graphContainer"};function Gt(e,t,a,i,n,s){const o=r("loading-spinner");return l(),u("div",Ut,[p("div",qt,[c(o,{"is-enabled":s.isLoading},null,8,["is-enabled"])],512)])}const Ht=m(jt,[["render",Gt],["__scopeId","data-v-7520aac4"]]),zt={name:"RadionuclideTables",components:{LoadingSpinner:$e},props:{feature:{type:Object,default:()=>({})},date:Date},data(){return{tablesData:[],isLoading:!1,helsinkiVantaa:!1}},computed:{formatDates(){return e=>{switch(this.$store.state.settings.settings.dateFormat){case"fi":default:return`${e.getDate()}.${e.getMonth()+1}.${e.getFullYear()}`;case"iso":return`${e.getFullYear()}-${e.getMonth()+1}-${e.getDate()}`}}},hasData(){return this.tablesData.some(e=>e.entries.length>0)},mode(){return this.$store.state.settings.settings.mode},isAirRadionuclidesMode(){return this.mode==="air_radionuclides"},sortedTablesData(){const e=["Be-7","Cs-137","Pb-210","Na-22"];return this.tablesData.slice().sort((t,a)=>{const i=e.indexOf(t.radionuclide),n=e.indexOf(a.radionuclide);return i===-1&&n===-1?0:i===-1?1:n===-1?-1:i-n})}},watch:{feature:{immediate:!0,handler(){this.fetchData(new Date)}}},mounted(){f.$on("dateChanged",this.fetchData)},methods:{async fetchData(e){if(!this.feature||!this.feature.get)return;const t=this.feature.get("id");if(t&&(t==103428||t==107554?this.helsinkiVantaa=!0:this.helsinkiVantaa=!1,this.isAirRadionuclidesMode))try{this.isLoading=!0;let a=await H.getAvailableRadionuclides(t);if(a=a.filter(n=>n!=="air-volume"),!a||a.length===0)return;const i=a.map(async n=>{try{const s=await H.getTimeSeries(t,n,e),o=this.removeDuplicates(s||[]).sort((d,h)=>new Date(h.s)-new Date(d.s));return{radionuclide:n,entries:o}}catch(s){return console.error(`Error fetching data for radionuclide ${n}:`,s),{radionuclide:n,entries:[]}}});this.tablesData=await Promise.all(i)}catch(a){console.error("Error in fetching data:",a)}finally{this.isLoading=!1}},removeDuplicates(e){const t=new Set;return e.filter(a=>{const i=`${a.s}-${a.e}-${a.c}-${a.u}`;return t.has(i)?!1:(t.add(i),!0)})},isPriorityNuclide(e){return["Be-7","Cs-137","Pb-210","Na-22"].includes(e)}}},Yt={class:"radionuclide-tables"},Kt={key:0},Zt={key:0},Jt={key:0},Wt={key:1},Qt={key:0};function Xt(e,t,a,i,n,s){const o=r("loading-spinner");return l(),u("div",Yt,[c(o,{"is-enabled":n.isLoading},null,8,["is-enabled"]),n.isLoading?D("",!0):(l(),u("div",Kt,[s.hasData?(l(),u("div",Zt,[(l(!0),u(R,null,B(s.sortedTablesData,(d,h)=>(l(),u("div",{key:h,class:"table-container"},[d.entries.length>0?(l(),u("div",Jt,[p("p",{class:C({"bold-header":!s.isPriorityNuclide(d.radionuclide)})},g(d.radionuclide),3),p("table",null,[p("thead",null,[p("tr",null,[p("th",null,g(e.$t("radionuclideMode.date")),1),p("th",null,g(e.$t("radionuclideMode.concentration"))+" µBq/m3",1),p("th",null,g(e.$t("radionuclideMode.uncertainty"))+"-%",1)])]),p("tbody",null,[(l(!0),u(R,null,B(d.entries,b=>(l(),u("tr",{key:b.s},[p("td",null,g(s.formatDates(new Date(b.s)))+" - "+g(s.formatDates(new Date(b.e))),1),p("td",null,g(b.c),1),p("td",null,g(b.u),1)]))),128))])])])):D("",!0)]))),128))])):D("",!0),s.hasData?D("",!0):(l(),u("div",Wt,[p("p",null,g(e.$t("radionuclideMode.noData")),1),n.helsinkiVantaa?(l(),u("p",Qt,g(e.$t("radionuclideMode.info")),1)):D("",!0)]))]))])}const ea=m(zt,[["render",Xt],["__scopeId","data-v-4d03d4a2"]]),ta={name:"DatePicker",components:{VueDatePicker:he},emits:["dateChanged"],data(){return{selectedDate:new Date,fi:"fi",en:"en"}},computed:{language(){switch(this.$store.state.settings.settings.locale){case"en":default:return this.en;case"fi":return this.fi}},pastDate(){const e=new Date(this.selectedDate);return e.setDate(e.getDate()-30),e},isToday(){const e=new Date;return this.selectedDate.getDate()===e.getDate()&&this.selectedDate.getMonth()===e.getMonth()&&this.selectedDate.getFullYear()===e.getFullYear()},mode(){return this.$store.state.settings.settings.mode}},mounted(){f.$on("featureClicked",this.resetDate)},methods:{formatDates(e){switch(this.$store.state.settings.settings.dateFormat){case"fi":return`${e.getDate()}.${e.getMonth()+1}.${e.getFullYear()}`;case"iso":default:return`${e.getFullYear()}-${(e.getMonth()+1).toString().padStart(2,"0")}-${e.getDate().toString().padStart(2,"0")}`}},resetDate(){this.mode=="air_radionuclides"&&(this.selectedDate=new Date)},handleDateChange(e){this.selectedDate=new Date(e),f.$emit("dateChanged",this.selectedDate)},prevDay(){const e=new Date(this.selectedDate);e.setDate(e.getDate()-1),this.selectedDate=e,f.$emit("dateChanged",this.selectedDate)},nextDay(){const e=new Date(this.selectedDate);this.isToday||(e.setDate(e.getDate()+1),this.selectedDate=e,f.$emit("dateChanged",this.selectedDate))}}},aa={class:"date-picker"},sa={class:"controls"};function na(e,t,a,i,n,s){const o=r("vue-date-picker");return l(),u("div",aa,[p("div",sa,[p("p",null,g(s.formatDates(s.pastDate))+" -",1),p("button",{onClick:t[0]||(t[0]=(...d)=>s.prevDay&&s.prevDay(...d))}," < "),c(o,{modelValue:n.selectedDate,"onUpdate:modelValue":t[1]||(t[1]=d=>n.selectedDate=d),locale:s.language,format:s.formatDates,"auto-apply":"","enable-time-picker":!1,"max-date":new Date,"hide-input-icon":"",onDateUpdate:s.handleDateChange},null,8,["modelValue","locale","format","max-date","onDateUpdate"]),p("button",{class:C({disabled:s.isToday}),onClick:t[2]||(t[2]=(...d)=>s.nextDay&&s.nextDay(...d))}," > ",2)])])}const ia=m(ta,[["render",na]]),oa={name:"FeaturePopup",components:{SiteName:ge,SiteDoseRate:_e,TimeSeriesGraph:Ht,RadionuclideTables:ea,DatePicker:ia},emits:["featurepopupOpened","featurepopupClosed"],data(){return{overlay:void 0,feature:void 0}},computed:{mode(){return this.$store.state.settings.settings.mode},isDoseRatesMode(){return this.mode==="dose_rates"},isRadionuclideMode(){return this.mode==="air_radionuclides"}},watch:{isDoseRatesMode(){this.close()}},mounted(){f.$on("featureClicked",this.open),f.$on("emptyMapLocationClicked",this.close),this.overlay=new me({element:this.$refs.featurePopup,position:void 0}),f.$on("featureClicked",this.open),f.$on("featureSelectedViaSearch",this.open),f.$on("emptyMapLocationClicked",this.close),f.$on("doseRateLayerChanged",this.update)},methods:{open(e){this.feature=e,this.overlay.setPosition(e.getGeometry().getCoordinates()),f.$emit("featurePopupOpened",e),this.$nextTick(()=>{this.$refs.panelBody&&(this.$refs.panelBody.scrollTop=0)})},close(){this.feature=void 0,this.overlay.setPosition(void 0),f.$emit("featurePopupClosed")},update(e){var t=e.getSource().getFeatures();if(!(t.length==0||!this.feature)){for(var a=0;a<t.length;++a)if(t[a].get("id")==this.feature.get("id")){this.feature=t[a];return}this.feature.set("doseRate","-")}}}},ra={ref:"featurePopup",class:"feature-popup"};function la(e,t,a,i,n,s){const o=r("site-name"),d=r("site-dose-rate"),h=r("time-series-graph"),b=r("date-picker"),v=r("radionuclide-tables");return l(),u("div",ra,[c(o,{feature:n.feature,onClose:s.close},null,8,["feature","onClose"]),$(c(d,{feature:n.feature},null,8,["feature"]),[[y,s.isDoseRatesMode]]),$(c(h,{feature:n.feature},null,8,["feature"]),[[y,s.isDoseRatesMode]]),$(c(b,null,null,512),[[y,s.isRadionuclideMode]]),$(c(v,{feature:n.feature},null,8,["feature"]),[[y,s.isRadionuclideMode]])],512)}const da=m(oa,[["render",la],["__scopeId","data-v-5984984b"]]),ca={name:"ButtonOpenSettings",emits:["settings-panel-open"],methods:{handleClick(){f.$emit("settings-panel-open")}}},ua=["title"],ma=p("span",{class:"button-open-settings__icon"},null,-1),pa=[ma];function ha(e,t,a,i,n,s){return l(),u("div",{class:"button-open-settings",title:e.$t("settings.title"),onClick:t[0]||(t[0]=o=>s.handleClick())},pa,8,ua)}const fa=m(ca,[["render",ha]]),ga={name:"ButtonOpenInfo",emits:["info-panel-open"],methods:{handleClick(){f.$emit("info-panel-open")}}},_a=e=>(Y("data-v-9c6735c7"),e=e(),K(),e),ba=["title"],$a=_a(()=>p("span",{class:"button-open-info__icon"},null,-1)),ya=[$a];function va(e,t,a,i,n,s){return l(),u("div",{class:"button-open-info",title:e.$t("info.title"),onClick:t[0]||(t[0]=o=>s.handleClick())},ya,8,ba)}const Da=m(ga,[["render",va],["__scopeId","data-v-9c6735c7"]]),ka={name:"ButtonChangeMode",computed:{mode(){return this.$store.state.settings.settings.mode},isDoseRate(){return this.mode==="dose_rates"},isAirRadionuclides(){return this.mode==="air_radionuclides"}},methods:{handleClick(){const e=this.mode==="dose_rates"?"air_radionuclides":"dose_rates";f.$emit("mode-changed",e)}}},Sa=e=>(Y("data-v-3898a807"),e=e(),K(),e),wa=["title"],Ca=Sa(()=>p("span",{class:"button-change-mode__icon"},null,-1));function La(e,t,a,i,n,s){return l(),u("div",{class:"button-change-mode",title:e.$t("changeMode.title"),onClick:t[0]||(t[0]=(...o)=>s.handleClick&&s.handleClick(...o))},[Ca,p("h3",null,[p("span",{class:C({selected:s.isDoseRate,notSelected:!s.isDoseRate})},g(e.$t("doseRate")),3),O(" / "),p("span",{class:C({selected:s.isAirRadionuclides,notSelected:!s.isAirRadionuclides})},g(e.$t("airRadionuclides")),3)])],8,wa)}const Ta=m(ka,[["render",La],["__scopeId","data-v-3898a807"]]),Ma={name:"SettingsPanelHeader",emits:["close"]},Fa={class:"settings-panel-header opendata-row"};function Pa(e,t,a,i,n,s){return l(),u("div",Fa,[p("span",null,g(e.$t("settings.header")),1),p("span",{class:"close-button",onClick:t[0]||(t[0]=o=>e.$emit("close"))},"×")])}const Ra=m(Ma,[["render",Pa],["__scopeId","data-v-79d97c99"]]),Ba={name:"SettingsPanelSection",props:{title:{type:String,required:!0}}},Ia={class:"section"},Va={class:"title"};function Oa(e,t,a,i,n,s){return l(),u("div",Ia,[p("p",Va,g(a.title),1),Le(e.$slots,"default",{class:"content"},void 0,!0)])}const x=m(Ba,[["render",Oa],["__scopeId","data-v-fed687d3"]]),Ea={name:"FieldLanguage",components:{SettingsPanelSection:x},props:{settings:{type:Object,required:!0}}};function Aa(e,t,a,i,n,s){const o=r("base-radio-button"),d=r("settings-panel-section");return l(),_(d,{title:e.$t("settings.language")},{default:E(()=>[c(o,{key:"fi",modelValue:a.settings.locale,"onUpdate:modelValue":t[0]||(t[0]=h=>a.settings.locale=h),"model-value":a.settings.locale,"own-value":"fi",label:e.$t("settings.labelFinnish"),class:"radio-button"},null,8,["modelValue","model-value","label"]),c(o,{key:"en",modelValue:a.settings.locale,"onUpdate:modelValue":t[1]||(t[1]=h=>a.settings.locale=h),"model-value":a.settings.locale,"own-value":"en",label:e.$t("settings.labelEnglish"),class:"radio-button"},null,8,["modelValue","model-value","label"])]),_:1},8,["title"])}const xa=m(Ea,[["render",Aa],["__scopeId","data-v-bfcd2737"]]),Na={name:"FieldDateFormat",components:{SettingsPanelSection:x},props:{settings:{type:Object,required:!0}}};function ja(e,t,a,i,n,s){const o=r("base-radio-button"),d=r("settings-panel-section");return l(),_(d,{title:e.$t("settings.dateFormat")},{default:E(()=>[c(o,{key:"fi",modelValue:a.settings.dateFormat,"onUpdate:modelValue":t[0]||(t[0]=h=>a.settings.dateFormat=h),"model-value":a.settings.dateFormat,"own-value":"fi",label:e.$t("settings.dateFormatA"),class:"radio-button"},null,8,["modelValue","model-value","label"]),c(o,{key:"iso",modelValue:a.settings.dateFormat,"onUpdate:modelValue":t[1]||(t[1]=h=>a.settings.dateFormat=h),"model-value":a.settings.dateFormat,"own-value":"iso",label:e.$t("settings.dateFormatB"),class:"radio-button"},null,8,["modelValue","model-value","label"])]),_:1},8,["title"])}const Ua=m(Na,[["render",ja],["__scopeId","data-v-b4352245"]]),qa={name:"FieldTimeFormat",components:{SettingsPanelSection:x},props:{settings:{type:Object,required:!0}}};function Ga(e,t,a,i,n,s){const o=r("base-radio-button"),d=r("settings-panel-section");return l(),_(d,{title:e.$t("settings.timeFormat")},{default:E(()=>[c(o,{key:"24h",modelValue:a.settings.timeFormat,"onUpdate:modelValue":t[0]||(t[0]=h=>a.settings.timeFormat=h),"model-value":a.settings.timeFormat,"own-value":"24h",label:e.$t("settings.timeFormatA"),class:"radio-button"},null,8,["modelValue","model-value","label"]),c(o,{key:"12h",modelValue:a.settings.timeFormat,"onUpdate:modelValue":t[1]||(t[1]=h=>a.settings.timeFormat=h),"model-value":a.settings.timeFormat,"own-value":"12h",label:e.$t("settings.timeFormatB"),class:"radio-button"},null,8,["modelValue","model-value","label"])]),_:1},8,["title"])}const Ha=m(qa,[["render",Ga],["__scopeId","data-v-505c2119"]]);let za,Ya;const Ka=new Re({source:new Be({url:"https://{a-c}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),preload:100}),Za=!1,Ja={name:"FieldBackgroundMap",components:{SettingsPanelSection:x},props:{settings:{type:Object,required:!0}},data(){return{customMapsEnabled:Za}}};function Wa(e,t,a,i,n,s){const o=r("base-radio-button"),d=r("settings-panel-section");return l(),_(d,{title:e.$t("settings.backgroundMap")},{default:E(()=>[c(o,{key:"default",modelValue:a.settings.backgroundMap,"onUpdate:modelValue":t[0]||(t[0]=h=>a.settings.backgroundMap=h),"model-value":a.settings.backgroundMap,"own-value":"default",label:e.$t("settings.backgroundMapDefault"),class:"radio-button"},null,8,["modelValue","model-value","label"]),n.customMapsEnabled?(l(),_(o,{key:"custom",modelValue:a.settings.backgroundMap,"onUpdate:modelValue":t[1]||(t[1]=h=>a.settings.backgroundMap=h),"model-value":a.settings.backgroundMap,"own-value":"custom",label:e.$t("settings.backgroundMapCustom"),class:"radio-button"},null,8,["modelValue","model-value","label"])):D("",!0)]),_:1},8,["title"])}const Qa=m(Ja,[["render",Wa],["__scopeId","data-v-e2e045d7"]]),Xa={name:"BaseBackdrop",emits:["click"]};function es(e,t,a,i,n,s){return l(),u("div",{class:"backdrop",onClick:t[0]||(t[0]=o=>e.$emit("click"))})}const N=m(Xa,[["render",es],["__scopeId","data-v-6e4e4d03"]]),ts={name:"AppVersion",computed:{appVersion(){return"v3.0.0"}}},as={class:"row justify-content-center mt-3 app-version"};function ss(e,t,a,i,n,s){return l(),u("div",as,[p("span",null,g(s.appVersion),1)])}const ns=m(ts,[["render",ss]]),is={name:"SettingsPanel",components:{SettingsPanelHeader:Ra,FieldLanguage:xa,FieldDateFormat:Ua,FieldTimeFormat:Ha,FieldBackgroundMap:Qa,BaseBackdrop:N,AppVersion:ns},emits:["settingsChanged"],data:function(){return{isEnabled:!1,settings:new be}},watch:{settings:{deep:!0,handler(){this.saveSettings()}}},mounted(){f.$on("settings-panel-open",this.enable),f.$on("mode-changed",this.modeChange)},methods:{enable(){this.settings=V(this.$store.state.settings.settings),this.isEnabled=!0,this.$nextTick(()=>{this.$refs.panelBody&&(this.$refs.panelBody.scrollTop=0)})},disable(){this.isEnabled=!1,this.saveSettings()},saveSettings(){this.$store.commit("setSettings",V(this.settings)),f.$emit("settingsChanged")},modeChange(e){this.settings=V(this.$store.state.settings.settings),this.settings.mode=e,this.$store.commit("setSettings",V(this.settings))}}},os={class:"settings-panel"},rs={ref:"panelBody",class:"settings-panel-body"};function ls(e,t,a,i,n,s){const o=r("base-backdrop"),d=r("settings-panel-header"),h=r("field-language"),b=r("field-date-format"),v=r("field-time-format"),k=r("field-background-map"),S=r("app-version");return $((l(),u("div",null,[c(o,{onClick:s.disable},null,8,["onClick"]),p("div",os,[c(d,{onClose:s.disable},null,8,["onClose"]),p("div",rs,[c(h,{settings:e.settings},null,8,["settings"]),c(b,{settings:e.settings},null,8,["settings"]),c(v,{settings:e.settings},null,8,["settings"]),c(k,{settings:e.settings},null,8,["settings"]),c(S)],512)])],512)),[[y,e.isEnabled]])}const ds=m(is,[["render",ls]]),cs={name:"InfoPanelHeader",emits:["close"]},us={class:"info-panel-header opendata-row"};function ms(e,t,a,i,n,s){return l(),u("div",us,[p("span",null,g(e.$t("info.title")),1),p("span",{class:"close-button",onClick:t[0]||(t[0]=o=>e.$emit("close"))},"×")])}const ps=m(cs,[["render",ms],["__scopeId","data-v-f30c3c6d"]]),hs={name:"InfoPanel",components:{InfoPanelHeader:ps,BaseBackdrop:N},data:function(){return{isEnabled:!1}},mounted(){f.$on("info-panel-open",this.enable)},methods:{enable(){this.isEnabled=!0,this.$nextTick(()=>{this.$refs.panelBody&&(this.$refs.panelBody.scrollTop=0)})},disable(){this.isEnabled=!1}}},fs={class:"info-panel"},gs={class:"info-panel-body"},_s={href:"https://github.com/StukFi/opendata",target:"_blank"};function bs(e,t,a,i,n,s){const o=r("base-backdrop"),d=r("info-panel-header");return $((l(),u("div",null,[c(o,{onClick:s.disable},null,8,["onClick"]),p("div",fs,[c(d,{onClose:s.disable},null,8,["onClose"]),p("div",gs,[p("p",null,g(e.$t("info.p1")),1),p("p",null,[O(g(e.$t("info.p2"))+" ",1),p("a",_s,g(e.$t("info.p3")),1),O(". ")])])])],512)),[[y,e.isEnabled]])}const $s=m(hs,[["render",bs]]),ys={name:"MediaControllerButton",props:{icon:{type:String,default:""},text:{type:String,default:""},disabled:{type:Boolean,default:!1}},emits:["click"],computed:{style(){return this.icon?{backgroundImage:`url(/icons/${this.icon}.svg)`}:{}}}},vs=["disabled"];function Ds(e,t,a,i,n,s){return l(),u("button",{style:z(s.style),disabled:a.disabled,onClick:t[0]||(t[0]=o=>e.$emit("click"))},g(a.text),13,vs)}const J=m(ys,[["render",Ds],["__scopeId","data-v-43287a41"]]),ks={name:"ButtonPlaybackState",components:{MediaControllerButton:J},props:{mediaController:{type:Object,required:!0}},computed:{icon(){return this.mediaController.state.isPlaybackEnabled?"media-pause":"media-play"},disabled(){return this.mediaController.isPlaybackFinished()},title(){if(this.disabled){if(this.mediaController.state.playbackMode==="time")return this.$t("playback.title.disabled.time");if(this.mediaController.state.playbackMode==="date")return this.$t("playback.title.disabled.date")}else return this.mediaController.state.isPlaybackEnabled?this.$t("playback.title.stop"):this.$t("playback.title.start");return""}},methods:{handleClick(){this.mediaController.togglePlayback()}}};function Ss(e,t,a,i,n,s){const o=r("media-controller-button");return l(),_(o,{icon:s.icon,disabled:s.disabled,title:s.title,onClick:s.handleClick},null,8,["icon","disabled","title","onClick"])}const ws=m(ks,[["render",Ss]]),Cs={name:"ButtonPlaybackMode",components:{MediaControllerButton:J},props:{mediaController:{type:Object,required:!0}},computed:{icon(){return this.mediaController.state.playbackMode==="time"?"clock":"calendar"},title(){return this.mediaController.state.playbackMode==="time"?this.$t("playback.title.time"):this.$t("playback.title.date")}},methods:{handleClick(){this.mediaController.toggleMode()}}};function Ls(e,t,a,i,n,s){const o=r("media-controller-button");return l(),_(o,{icon:s.icon,title:s.title,onClick:s.handleClick},null,8,["icon","title","onClick"])}const Ts=m(Cs,[["render",Ls]]),Ms={name:"ButtonPlaybackSpeed",components:{MediaControllerButton:J},props:{mediaController:{type:Object,required:!0}},computed:{playbackSpeed(){return this.mediaController.state.playbackSpeed/1e3+" s"}},methods:{handleClick(){this.mediaController.toggleSpeed()}}};function Fs(e,t,a,i,n,s){const o=r("media-controller-button");return l(),_(o,{text:s.playbackSpeed,title:e.$t("playback.title.speed"),onClick:s.handleClick},null,8,["text","title","onClick"])}const Ps=m(Ms,[["render",Fs]]);let Rs=class{constructor(){this.state=Te({isPlaybackEnabled:!1,playbackMode:"time",playbackSpeed:1e3,playbackSpeeds:[500,1e3,2e3],playbackTimeoutId:void 0})}play(){this.state.isPlaybackEnabled||(this.state.isPlaybackEnabled=!0,this.tick())}stop(){this.state.isPlaybackEnabled=!1,clearTimeout(this.state.playbackTimeoutId)}async tick(){if(this.state.isPlaybackEnabled){if(this.isPlaybackFinished()){this.stop();return}this.state.playbackMode==="date"?await T.dispatch("incrementDate"):this.state.playbackMode==="time"&&await T.dispatch("incrementTime"),this.state.playbackTimeoutId=setTimeout(()=>this.tick(),this.state.playbackSpeed)}}togglePlayback(){this.state.isPlaybackEnabled?this.stop():this.play()}toggleMode(){this.state.playbackMode=this.state.playbackMode==="date"?"time":"date"}toggleSpeed(){const t=this.state.playbackSpeeds.indexOf(this.state.playbackSpeed);this.state.playbackSpeed=t>=this.state.playbackSpeeds.length-1?this.state.playbackSpeeds[0]:this.state.playbackSpeeds[t+1]}isPlaybackFinished(){return this.state.playbackMode==="time"&&T.getters.isNewestTimeSelected||this.state.playbackMode==="date"&&T.getters.isNewestDateSelected}};function Bs(){return new Rs}const Is={name:"MediaController",components:{ButtonPlaybackState:ws,ButtonPlaybackMode:Ts,ButtonPlaybackSpeed:Ps},data(){return{mediaController:Bs()}}},Vs={class:"media-controller"};function Os(e,t,a,i,n,s){const o=r("button-playback-mode"),d=r("button-playback-state"),h=r("button-playback-speed");return l(),u("div",Vs,[c(o,{"media-controller":n.mediaController},null,8,["media-controller"]),c(d,{"media-controller":n.mediaController},null,8,["media-controller"]),c(h,{"media-controller":n.mediaController},null,8,["media-controller"])])}const Es=m(Is,[["render",Os]]),As={name:"SearchSuggestListItem",props:{suggestion:{type:String,required:!0}},emits:["click"]};function xs(e,t,a,i,n,s){return l(),u("p",{class:"search-suggest-list-item",onClick:t[0]||(t[0]=o=>e.$emit("click"))},g(a.suggestion),1)}const Ns=m(As,[["render",xs]]),js={name:"SearchSuggestList",components:{SearchSuggestListItem:Ns},props:{searchTerm:{type:String,required:!0},sites:{type:Array,required:!0}},emits:["select"],data:function(){return{isEnabled:!1}},computed:{suggestions(){let e=[];return this.sites.forEach(t=>{t.toLowerCase().indexOf(this.searchTerm.toLowerCase())>=0&&(e.includes(t)||e.push(t))}),e.sort()}},methods:{show(){this.isEnabled=!0},hide(){this.isEnabled=!1}}},Us={class:"search-suggest-list"},qs={class:"list-container"};function Gs(e,t,a,i,n,s){const o=r("search-suggest-list-item");return $((l(),u("div",Us,[p("div",qs,[(l(!0),u(R,null,B(s.suggestions,d=>(l(),_(o,{key:d,suggestion:d,onClick:h=>e.$emit("select",d)},null,8,["suggestion","onClick"]))),128))])],512)),[[y,e.isEnabled&&s.suggestions.length>0]])}const Hs=m(js,[["render",Gs]]),zs={name:"SearchBar",components:{SearchSuggestList:Hs},mixins:[fe],emits:["featureSelectedViaSearch"],data(){return{searchTerm:"",features:[]}},computed:{mode(){return this.$store.state.settings.settings.mode},isDoseRateMode(){return this.mode==="dose_rates"},isAirRadionuclidesMode(){return this.mode==="air_radionuclides"},sites(){let e=[];for(let t=0;t<this.features.length;++t){const a=this.features[t].get("site");e.includes(a)||e.push(a)}return e}},watch:{mode(e){(e==="dose_rates"||e==="air_radionuclides")&&this.updateFeatures()}},mounted(){this.isDoseRateMode?f.$on("doseRateLayerChanged",this.onDoseRateLayerChanged):this.isAirRadionuclidesMode&&f.$on("radionuclideLayerChanged",this.onRadionuclideLayerChanged)},methods:{updateFeatures(){this.features=[],this.isDoseRateMode?(f.$off("radionuclideLayerChanged",this.onRadionuclideLayerChanged),f.$on("doseRateLayerChanged",this.onDoseRateLayerChanged)):this.isAirRadionuclidesMode&&(f.$off("doseRateLayerChanged",this.onDoseRateLayerChanged),f.$on("radionuclideLayerChanged",this.onRadionuclideLayerChanged))},onDoseRateLayerChanged(e){this.features=e.getSource().getFeatures()},onRadionuclideLayerChanged(e){this.features=e.getSource().getFeatures()},onSuggestionSelected(e){this.searchTerm=e,this.search()},search(){if(this.searchTerm.length>0){const e=this.isDoseRateMode?"dose_rates":"air_radionuclides";for(let t=0;t<this.features.length;++t){const a=this.features[t].get("site");if(a.toLowerCase()===this.searchTerm.toLowerCase()){this.searchTerm=a,this.blur(),f.$emit("featureSelectedViaSearch",this.features[t],e);break}}}},showSuggestions(){this.$refs.searchSuggestList.show()},hideSuggestions(){this.$refs.searchSuggestList.hide()},blur(){this.$refs.searchBarInput.blur(),this.hideSuggestions()}}},Ys=["value"];function Ks(e,t,a,i,n,s){const o=r("search-suggest-list"),d=Me("click-away");return $((l(),u("div",{class:C(["search-bar",{"dose-rate-mode":s.isDoseRateMode,"air-radionuclides-mode":s.isAirRadionuclidesMode}])},[p("span",{class:"search-bar__icon",onClick:t[0]||(t[0]=h=>s.search())}),p("input",{ref:"searchBarInput",value:n.searchTerm,type:"text",maxlength:"28",spellcheck:!1,class:"search-bar__input",onInput:t[1]||(t[1]=h=>n.searchTerm=h.target.value),onClick:t[2]||(t[2]=h=>s.showSuggestions()),onFocus:t[3]||(t[3]=h=>s.showSuggestions()),onKeyup:t[4]||(t[4]=Fe(h=>s.search(),["enter"]))},null,40,Ys),c(o,{ref:"searchSuggestList","search-term":n.searchTerm,sites:s.sites,onSelect:s.onSuggestionSelected},null,8,["search-term","sites","onSelect"])],2)),[[d,s.blur]])}const Zs=m(zs,[["render",Ks]]),Js={name:"ButtonDateTime",props:{icon:{type:String,required:!0},disabled:{type:Boolean,default:!1}},emits:["click"],data(){return{iconStyle:{backgroundImage:"none"}}},watch:{icon:"updateStyle",disabled:"updateStyle"},mounted(){this.updateStyle()},methods:{async updateStyle(){if(this.disabled)this.iconStyle={backgroundImage:"none"};else try{const e=`/icons/${this.icon}.svg`;this.disabled||(this.iconStyle={backgroundImage:`url(${e})`})}catch{this.iconStyle={backgroundImage:"none"}}}}},Ws=["disabled"];function Qs(e,t,a,i,n,s){return l(),u("button",{style:z(n.iconStyle),disabled:a.disabled,onClick:t[0]||(t[0]=o=>e.$emit("click"))},null,12,Ws)}const j=m(Js,[["render",Qs],["__scopeId","data-v-8b41e01d"]]),Xs={name:"ButtonDecrementDate",components:{ButtonDateTime:j},computed:{isOldestDateSelected(){return this.$store.getters.isOldestDateSelected}},methods:{decrementDate(){this.$store.dispatch("decrementDate")}}};function en(e,t,a,i,n,s){const o=r("button-date-time");return l(),_(o,{icon:"caret-left",disabled:s.isOldestDateSelected,onClick:t[0]||(t[0]=d=>s.decrementDate())},null,8,["disabled"])}const tn=m(Xs,[["render",en],["__scopeId","data-v-fbb26811"]]),an={name:"ButtonIncrementDate",components:{ButtonDateTime:j},computed:{isNewestDateSelected(){return this.$store.getters.isNewestDateSelected}},methods:{incrementDate(){this.$store.dispatch("incrementDate")}}};function sn(e,t,a,i,n,s){const o=r("button-date-time");return l(),_(o,{icon:"caret-right",disabled:s.isNewestDateSelected,onClick:t[0]||(t[0]=d=>s.incrementDate())},null,8,["disabled"])}const nn=m(an,[["render",sn],["__scopeId","data-v-3c041075"]]),on={name:"ButtonDatepicker",emits:["calendar-popup-open"],computed:{selectedDate(){const e=this.$store.state.datetime.selectedDate;if(e)switch(this.$store.state.settings.settings.dateFormat){case"fi":default:return e.getDate()+"."+(e.getMonth()+1)+"."+e.getFullYear();case"iso":return e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate()}}},methods:{openCalendar(){f.$emit("calendar-popup-open")}}};function rn(e,t,a,i,n,s){return l(),u("div",{class:"datepicker-button opendata-row",onClick:t[0]||(t[0]=(...o)=>s.openCalendar&&s.openCalendar(...o))},g(s.selectedDate),1)}const ln=m(on,[["render",rn]]),dn={name:"DateWidget",components:{ButtonDecrementDate:tn,ButtonIncrementDate:nn,ButtonDatepicker:ln}},cn={class:"date-widget"};function un(e,t,a,i,n,s){const o=r("button-decrement-date"),d=r("button-datepicker"),h=r("button-increment-date");return l(),u("div",cn,[c(o),c(d),c(h)])}const mn=m(dn,[["render",un],["__scopeId","data-v-90531585"]]),pn={name:"ButtonDecrementTime",components:{ButtonDateTime:j},computed:{isOldestTimeSelected(){return this.$store.getters.isOldestTimeSelected}},methods:{decrementTime(){this.$store.dispatch("decrementTime")}}};function hn(e,t,a,i,n,s){const o=r("button-date-time");return l(),_(o,{icon:"caret-left",disabled:s.isOldestTimeSelected,onClick:t[0]||(t[0]=d=>s.decrementTime())},null,8,["disabled"])}const fn=m(pn,[["render",hn],["__scopeId","data-v-d2bbd66d"]]),gn={name:"ButtonIncrementTime",components:{ButtonDateTime:j},computed:{isNewestTimeSelected(){return this.$store.getters.isNewestTimeSelected}},methods:{incrementTime(){this.$store.dispatch("incrementTime")}}};function _n(e,t,a,i,n,s){const o=r("button-date-time");return l(),_(o,{icon:"caret-right",disabled:s.isNewestTimeSelected,onClick:t[0]||(t[0]=d=>s.incrementTime())},null,8,["disabled"])}const bn=m(gn,[["render",_n],["__scopeId","data-v-719478c8"]]),$n={name:"Timepicker",emits:["timepicker-list-toggle"],computed:{formattedTime(){let e=this.$store.state.datetime.selectedTime;if(e)switch(e=e.slice(0,2)+":"+e.slice(2,4),this.$store.state.settings.settings.timeFormat){case"12h":return e=Z.convertTimeTo12HourClock(e),e.split(" ")[0]+"Z "+e.split(" ")[1];case"24h":default:return e+"Z"}}},methods:{toggleTimeList(){f.$emit("timepicker-list-toggle")}}},yn={class:"timepicker"};function vn(e,t,a,i,n,s){return l(),u("div",yn,[p("div",{class:"timepicker-button opendata-row",onClick:t[0]||(t[0]=(...o)=>s.toggleTimeList&&s.toggleTimeList(...o))},g(s.formattedTime),1)])}const Dn=m($n,[["render",vn]]),kn={name:"TimeWidget",components:{ButtonDecrementTime:fn,ButtonIncrementTime:bn,Timepicker:Dn}},Sn={class:"time-widget"};function wn(e,t,a,i,n,s){const o=r("button-decrement-time"),d=r("timepicker"),h=r("button-increment-time");return l(),u("div",Sn,[c(o),c(d),c(h)])}const Cn=m(kn,[["render",wn],["__scopeId","data-v-41c67fbc"]]),Ln={name:"TheHeader",components:{DateWidget:mn,TimeWidget:Cn}},Tn={class:"header"};function Mn(e,t,a,i,n,s){const o=r("date-widget"),d=r("time-widget");return l(),u("div",Tn,[c(o),c(d)])}const Fn=m(Ln,[["render",Mn],["__scopeId","data-v-a996c134"]]),Pn={name:"TimepickerListItem",props:{time:{type:String,default:""}},emits:["click"],computed:{selectedTime(){return this.$store.state.datetime.selectedTime},formattedTime(){let e=this.time.slice(0,2)+":"+this.time.slice(2,4);switch(this.$store.state.settings.settings.timeFormat){case"12h":return Z.convertTimeTo12HourClock(e);case"24h":default:return e}}},methods:{setTime(){this.$store.commit("setTime",this.time),this.$emit("click")}}};function Rn(e,t,a,i,n,s){return l(),u("li",{class:C({selected:a.time==s.selectedTime}),onClick:t[0]||(t[0]=(...o)=>s.setTime&&s.setTime(...o))},g(s.formattedTime),3)}const Bn=m(Pn,[["render",Rn]]),In={name:"TimepickerList",components:{TimepickerListItem:Bn,BaseBackdrop:N},data:function(){return{isEnabled:!1}},computed:{availableTimesForSelectedDate(){return this.$store.getters.availableTimesForSelectedDate}},mounted(){f.$on("timepicker-list-toggle",this.toggle)},methods:{close(){this.isEnabled=!1},toggle(){this.isEnabled=!this.isEnabled}}},Vn={class:"timepicker-list"},On={class:"list-container"};function En(e,t,a,i,n,s){const o=r("base-backdrop"),d=r("timepicker-list-item");return $((l(),u("div",null,[c(o,{onClick:s.close},null,8,["onClick"]),p("ul",Vn,[p("div",On,[(l(!0),u(R,null,B(s.availableTimesForSelectedDate.slice().reverse(),(h,b)=>(l(),_(d,{key:b,time:h,onClick:t[0]||(t[0]=v=>s.close())},null,8,["time"]))),128))])])],512)),[[y,e.isEnabled]])}const An=m(In,[["render",En],["__scopeId","data-v-bf2e8c75"]]),xn={name:"DatepickerPopup",components:{VueDatePicker:he,BaseBackdrop:N},data:function(){return{isEnabled:!1,fi:"fi",en:"en"}},computed:{language:{get(){switch(this.$store.state.settings.settings.locale){case"en":default:return this.en;case"fi":return this.fi}}},date:{get(){return this.$store.state.datetime.selectedDate},set(e){this.$store.dispatch("setDate",e)}},allowedDates(){var e=this.$store.state.datetime.availableDatasets,t=[];return e.length===0||e.forEach(a=>{t.push(new Date(a.date))}),t}},mounted(){f.$on("calendar-popup-open",this.open)},methods:{formatDate(e){switch(this.$store.state.settings.settings.dateFormat){case"fi":default:return e.getDate()+"."+(e.getMonth()+1)+"."+e.getFullYear();case"iso":return e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate()}},open(){this.isEnabled=!0},close(){this.isEnabled=!1}}};function Nn(e,t,a,i,n,s){const o=r("base-backdrop"),d=r("VueDatePicker");return $((l(),u("div",null,[c(o,{onClick:s.close},null,8,["onClick"]),c(d,{modelValue:s.date,"onUpdate:modelValue":t[0]||(t[0]=h=>s.date=h),inline:!0,"menu-class-name":"dp-custom-menu",locale:s.language,"auto-apply":"","hide-offset-dates":"","allowed-dates":s.allowedDates,onDateUpdate:s.close},null,8,["modelValue","locale","allowed-dates","onDateUpdate"])],512)),[[y,e.isEnabled]])}const jn=m(xn,[["render",Nn]]),Un={name:"TheMap",components:{DoseRateLayer:tt,RadionuclideLayer:nt,FeaturePopover:St,FeaturePopup:da,MapLegend:ut,SearchBar:Zs,ButtonOpenSettings:fa,ButtonOpenInfo:Da,ButtonChangeMode:Ta,SettingsPanel:ds,InfoPanel:$s,MediaController:Es,TheHeader:Fn,TimepickerList:An,DatepickerPopup:jn},emits:["featureClicked","featureHovered","emptyMapLocationClicked","emptyMapLocationHovered"],data(){return{map:null,baseLayer:null,default:Ka,custom:za,customStyle:Ya}},computed:{mode(){return this.$store.state.settings.settings.mode},isDoseRatesMode(){return this.mode==="dose_rates"},selectedBaseLayer(){return this.getBaseLayer()}},watch:{selectedBaseLayer(e){this.map&&this.map.getLayers().setAt(0,e)},mode(e){this.switchLayers(e==="dose_rates")}},mounted(){this.baseLayer=this.selectedBaseLayer,this.map=new Ie({target:"map",layers:[this.baseLayer],controls:[new Ve,new Oe,new Ee,new Ae],view:new xe({center:Ne([25.75,65.75]),enableRotation:!1,minZoom:4,maxZoom:16,zoom:5})}),this.custom===void 0?this.custom=this.default:this.customStyle!==void 0&&this.customStyle(this.custom),this.map.on("click",this.onMapInteraction),this.map.on("pointermove",this.onMapInteraction),this.map.on("moveend",this.onZoomChange),f.$on("featurePopupOpened",this.centerViewOnFeaturePopup),this.$refs.featurePopover&&this.$refs.featurePopover.overlay&&this.map.addOverlay(this.$refs.featurePopover.overlay),this.$refs.featurePopup&&this.$refs.featurePopup.overlay&&this.map.addOverlay(this.$refs.featurePopup.overlay),this.switchLayers(this.mode==="dose_rates")},methods:{getBaseLayer(){switch(this.$store.state.settings.settings.backgroundMap){case"custom":return this.custom;case"default":return this.default;default:return this.default}},switchLayers(e){if(this.map){const t=this.$refs.doseRateLayer?this.$refs.doseRateLayer.vectorLayer:null,a=this.$refs.radionuclideLayer?this.$refs.radionuclideLayer.vectorLayer:null;e?(a&&this.map.removeLayer(a),t&&(this.map.addLayer(t),this.onZoomChange())):(t&&this.map.removeLayer(t),a&&(this.map.addLayer(a),this.onZoomChange()))}},onMapInteraction(e){var t=this.map.getEventPixel(e.originalEvent),a=this.map.getFeaturesAtPixel(t,{layerFilter:i=>i!==this.custom});a.length>0?e.type=="click"?f.$emit("featureClicked",a[0]):e.type=="pointermove"&&f.$emit("featureHovered",a[0]):e.type=="click"?f.$emit("emptyMapLocationClicked"):e.type=="pointermove"&&f.$emit("emptyMapLocationHovered")},onZoomChange(){const e=this.map.getView().getZoom();this.$refs.doseRateLayer.updateFeatureRadius(e),this.$refs.radionuclideLayer.updateFeatureRadius(e)},centerViewOnFeaturePopup(e){if(this.map&&this.$refs.featurePopup&&this.$refs.featurePopup.$el){const t=e.getGeometry().getCoordinates(),a=this.map.getPixelFromCoordinate(t);a[1]-=this.$refs.featurePopup.$el.clientHeight*.58;const i=this.map.getCoordinateFromPixel(a);this.map.getView().animate({center:i,duration:750})}}}},qn={id:"map"};function Gn(e,t,a,i,n,s){const o=r("dose-rate-layer"),d=r("radionuclide-layer"),h=r("feature-popover"),b=r("feature-popup"),v=r("map-legend"),k=r("search-bar"),S=r("button-open-settings"),F=r("button-open-info"),U=r("button-change-mode"),P=r("settings-panel"),ye=r("info-panel"),ve=r("media-controller"),De=r("the-header"),ke=r("timepicker-list"),Se=r("datepicker-popup"),we=r("vue-progress-bar");return l(),u("div",qn,[c(o,{ref:"doseRateLayer"},null,512),c(d,{ref:"radionuclideLayer"},null,512),c(h,{ref:"featurePopover"},null,512),c(b,{ref:"featurePopup"},null,512),s.isDoseRatesMode?(l(),_(v,{key:0})):D("",!0),c(k),c(S),c(F),c(U),c(P),c(ye),s.isDoseRatesMode?(l(),_(ve,{key:1})):D("",!0),s.isDoseRatesMode?(l(),_(De,{key:2})):D("",!0),c(ke),c(Se),c(we)])}const Hn=m(Un,[["render",Gn]]),zn={name:"App",components:{TheMap:Hn},mounted(){this.$store.dispatch("initialize")}};function Yn(e,t,a,i,n,s){const o=r("the-map");return l(),_(o)}const Kn=m(zn,[["render",Yn]]),Zn={color:"white",failedColor:"#e95024",thickness:"0.25em"},M=Pe(Kn);M.use(T);M.use(G);M.use(Ge,Zn);M.use(fe);M.use(We);M.mount("#app");
